  
그러면 **Strapi 기본 SSO(유료 기능)** 말고, 직접 **소셜 로그인(구글, 네이버, 카카오, 페이스북)** 을 **User 모델**과 연결해서 구현하는 방식으로 접근하셔야 합니다.

---

## 🔑 구현 개요

**OAuth 2.0 / OIDC 플로우 적용**

구글, 페이스북은 OIDC(OpenID Connect) 지원.

네이버, 카카오는 OAuth2 기반 API 제공.

공통적으로 `Authorization Code Flow` 사용.

**프론트엔드 흐름**

사용자가 "구글/네이버/카카오/페이스북 로그인" 버튼 클릭 → 각 Provider 로그인 페이지 이동.

로그인 성공 시 → Redirect URL로 `code` 반환.

**백엔드(Strapi) 흐름**

Redirect 받은 `code`로 **Access Token** 교환.

해당 Access Token으로 사용자 정보(User Profile API) 호출.

예: 구글 → `https://www.googleapis.com/oauth2/v2/userinfo`

응답 JSON에서 `email`, `name`, `id` 추출.

**Strapi DB 처리**

이메일 기반으로 기존 User 존재 여부 확인.

없으면 신규 User 생성. (provider 필드: google/naver/kakao/facebook)

JWT 발급해서 프론트로 전달.

---

## 🔧 Strapi에서 구현 방법

### 1\. 사용자 모델 확장

`/src/api/user/content-types/user/schema.json`

```
{
  "kind": "collectionType",
  "collectionName": "users",
  "info": {
    "singularName": "user",
    "pluralName": "users",
    "displayName": "User"
  },
  "attributes": {
    "username": { "type": "string" },
    "email": { "type": "email", "unique": true },
    "provider": { "type": "string" },
    "socialId": { "type": "string" }
  }
}
```

### 2\. 인증 라우트 추가

`/src/api/auth/routes/auth.js`

```
module.exports = {
  routes: [
    {
      method: 'GET',
      path: '/auth/:provider/callback',
      handler: 'auth.socialCallback'
    }
  ]
};
```

### 3\. 컨트롤러 로직

`/src/api/auth/controllers/auth.js`

```
const axios = require("axios");
const jwt = require("@strapi/plugin-users-permissions/server/services/jwt");

module.exports = {
  async socialCallback(ctx) {
    const { provider } = ctx.params;
    const { code } = ctx.query;

    let tokenRes, userRes;

    if (provider === "google") {
      tokenRes = await axios.post("https://oauth2.googleapis.com/token", {
        code,
        client_id: process.env.GOOGLE_CLIENT_ID,
        client_secret: process.env.GOOGLE_CLIENT_SECRET,
        redirect_uri: process.env.GOOGLE_REDIRECT_URI,
        grant_type: "authorization_code",
      });

      userRes = await axios.get("https://www.googleapis.com/oauth2/v2/userinfo", {
        headers: { Authorization: `Bearer ${tokenRes.data.access_token}` }
      });
    }

    const profile = userRes.data;
    const email = profile.email;
    const socialId = profile.id || profile.sub;

    let user = await strapi.db.query("plugin::users-permissions.user").findOne({
      where: { email }
    });

    if (!user) {
      user = await strapi.db.query("plugin::users-permissions.user").create({
        data: {
          username: profile.name || email,
          email,
          provider,
          socialId,
        }
      });
    }

    const token = jwt.issue({ id: user.id });
    ctx.body = { jwt: token, user };
  }
};
```

---

## ✅ 결론

네이버/카카오/구글/페북 **모두 OAuth2 기반이라 로직은 비슷**합니다.

Strapi Community Edition에서도 직접 구현하면 무료로 사용 가능.

단, 관리자는 여전히 Strapi 계정으로 로그인해야 하고, **소셜 로그인은 사용자(User) 전용**으로 붙이는 구조가 됩니다.

---