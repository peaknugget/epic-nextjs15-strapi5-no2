  
ê·¸ëŸ¬ë©´ **Strapi ê¸°ë³¸ SSO(ìœ ë£Œ ê¸°ëŠ¥)** ë§ê³ , ì§ì ‘ **ì†Œì…œ ë¡œê·¸ì¸(êµ¬ê¸€, ë„¤ì´ë²„, ì¹´ì¹´ì˜¤, í˜ì´ìŠ¤ë¶)** ì„ **User ëª¨ë¸**ê³¼ ì—°ê²°í•´ì„œ êµ¬í˜„í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸ”‘ êµ¬í˜„ ê°œìš”

**OAuth 2.0 / OIDC í”Œë¡œìš° ì ìš©**

êµ¬ê¸€, í˜ì´ìŠ¤ë¶ì€ OIDC(OpenID Connect) ì§€ì›.

ë„¤ì´ë²„, ì¹´ì¹´ì˜¤ëŠ” OAuth2 ê¸°ë°˜ API ì œê³µ.

ê³µí†µì ìœ¼ë¡œ `Authorization Code Flow` ì‚¬ìš©.

**í”„ë¡ íŠ¸ì—”ë“œ íë¦„**

ì‚¬ìš©ìê°€ "êµ¬ê¸€/ë„¤ì´ë²„/ì¹´ì¹´ì˜¤/í˜ì´ìŠ¤ë¶ ë¡œê·¸ì¸" ë²„íŠ¼ í´ë¦­ â†’ ê° Provider ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™.

ë¡œê·¸ì¸ ì„±ê³µ ì‹œ â†’ Redirect URLë¡œ `code` ë°˜í™˜.

**ë°±ì—”ë“œ(Strapi) íë¦„**

Redirect ë°›ì€ `code`ë¡œ **Access Token** êµí™˜.

í•´ë‹¹ Access Tokenìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´(User Profile API) í˜¸ì¶œ.

ì˜ˆ: êµ¬ê¸€ â†’ `https://www.googleapis.com/oauth2/v2/userinfo`

ì‘ë‹µ JSONì—ì„œ `email`, `name`, `id` ì¶”ì¶œ.

**Strapi DB ì²˜ë¦¬**

ì´ë©”ì¼ ê¸°ë°˜ìœ¼ë¡œ ê¸°ì¡´ User ì¡´ì¬ ì—¬ë¶€ í™•ì¸.

ì—†ìœ¼ë©´ ì‹ ê·œ User ìƒì„±. (provider í•„ë“œ: google/naver/kakao/facebook)

JWT ë°œê¸‰í•´ì„œ í”„ë¡ íŠ¸ë¡œ ì „ë‹¬.

---

## ğŸ”§ Strapiì—ì„œ êµ¬í˜„ ë°©ë²•

### 1\. ì‚¬ìš©ì ëª¨ë¸ í™•ì¥

`/src/api/user/content-types/user/schema.json`

```
{
  "kind": "collectionType",
  "collectionName": "users",
  "info": {
    "singularName": "user",
    "pluralName": "users",
    "displayName": "User"
  },
  "attributes": {
    "username": { "type": "string" },
    "email": { "type": "email", "unique": true },
    "provider": { "type": "string" },
    "socialId": { "type": "string" }
  }
}
```

### 2\. ì¸ì¦ ë¼ìš°íŠ¸ ì¶”ê°€

`/src/api/auth/routes/auth.js`

```
module.exports = {
  routes: [
    {
      method: 'GET',
      path: '/auth/:provider/callback',
      handler: 'auth.socialCallback'
    }
  ]
};
```

### 3\. ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§

`/src/api/auth/controllers/auth.js`

```
const axios = require("axios");
const jwt = require("@strapi/plugin-users-permissions/server/services/jwt");

module.exports = {
  async socialCallback(ctx) {
    const { provider } = ctx.params;
    const { code } = ctx.query;

    let tokenRes, userRes;

    if (provider === "google") {
      tokenRes = await axios.post("https://oauth2.googleapis.com/token", {
        code,
        client_id: process.env.GOOGLE_CLIENT_ID,
        client_secret: process.env.GOOGLE_CLIENT_SECRET,
        redirect_uri: process.env.GOOGLE_REDIRECT_URI,
        grant_type: "authorization_code",
      });

      userRes = await axios.get("https://www.googleapis.com/oauth2/v2/userinfo", {
        headers: { Authorization: `Bearer ${tokenRes.data.access_token}` }
      });
    }

    const profile = userRes.data;
    const email = profile.email;
    const socialId = profile.id || profile.sub;

    let user = await strapi.db.query("plugin::users-permissions.user").findOne({
      where: { email }
    });

    if (!user) {
      user = await strapi.db.query("plugin::users-permissions.user").create({
        data: {
          username: profile.name || email,
          email,
          provider,
          socialId,
        }
      });
    }

    const token = jwt.issue({ id: user.id });
    ctx.body = { jwt: token, user };
  }
};
```

---

## âœ… ê²°ë¡ 

ë„¤ì´ë²„/ì¹´ì¹´ì˜¤/êµ¬ê¸€/í˜ë¶ **ëª¨ë‘ OAuth2 ê¸°ë°˜ì´ë¼ ë¡œì§ì€ ë¹„ìŠ·**í•©ë‹ˆë‹¤.

Strapi Community Editionì—ì„œë„ ì§ì ‘ êµ¬í˜„í•˜ë©´ ë¬´ë£Œë¡œ ì‚¬ìš© ê°€ëŠ¥.

ë‹¨, ê´€ë¦¬ìëŠ” ì—¬ì „íˆ Strapi ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì•¼ í•˜ê³ , **ì†Œì…œ ë¡œê·¸ì¸ì€ ì‚¬ìš©ì(User) ì „ìš©**ìœ¼ë¡œ ë¶™ì´ëŠ” êµ¬ì¡°ê°€ ë©ë‹ˆë‹¤.

---