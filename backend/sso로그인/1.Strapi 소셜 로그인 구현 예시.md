# Â Strapi User ëª¨ë¸ ê¸°ë°˜ ì†Œì…œ ë¡œê·¸ì¸ êµ¬í˜„ ì˜ˆì‹œì—Â 

# **ë„¤ì´ë²„, ì¹´ì¹´ì˜¤, í˜ì´ìŠ¤ë¶ê¹Œì§€ í¬í•¨í•œ ì „ì²´ ì¸ì¦ ì½”ë“œ ì˜ˆì‹œ**

---

## ğŸ”§ Strapi ì†Œì…œ ë¡œê·¸ì¸ êµ¬í˜„ ì˜ˆì‹œ (Google + Naver + Kakao + Facebook)

### 1\. ì‚¬ìš©ì ëª¨ë¸ í™•ì¥ (ê³µí†µ)

`/src/api/user/content-types/user/schema.json` ì°¸ê³ 

### 2\. ì¸ì¦ ë¼ìš°íŠ¸ ì¶”ê°€ (ê³µí†µ)

`/src/api/auth/routes/auth.js` ì°¸ê³ 

### 3\. ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§ (socialCallback)

`/src/api/auth/controllers/auth.js`

```
const axios = require("axios");
const jwt = require("@strapi/plugin-users-permissions/server/services/jwt");

module.exports = {
  async socialCallback(ctx) {
    const { provider } = ctx.params;
    const { code } = ctx.query;

    let tokenRes, userRes;

    if (provider === "google") {
      tokenRes = await axios.post("https://oauth2.googleapis.com/token", {
        code,
        client_id: process.env.GOOGLE_CLIENT_ID,
        client_secret: process.env.GOOGLE_CLIENT_SECRET,
        redirect_uri: process.env.GOOGLE_REDIRECT_URI,
        grant_type: "authorization_code",
      });

      userRes = await axios.get("https://www.googleapis.com/oauth2/v2/userinfo", {
        headers: { Authorization: `Bearer ${tokenRes.data.access_token}` }
      });
    }

    else if (provider === "naver") {
      tokenRes = await axios.post("https://nid.naver.com/oauth2.0/token", null, {
        params: {
          grant_type: "authorization_code",
          client_id: process.env.NAVER_CLIENT_ID,
          client_secret: process.env.NAVER_CLIENT_SECRET,
          code,
          state: process.env.NAVER_STATE,
        }
      });

      userRes = await axios.get("https://openapi.naver.com/v1/nid/me", {
        headers: { Authorization: `Bearer ${tokenRes.data.access_token}` }
      });
    }

    else if (provider === "kakao") {
      tokenRes = await axios.post("https://kauth.kakao.com/oauth/token", null, {
        params: {
          grant_type: "authorization_code",
          client_id: process.env.KAKAO_CLIENT_ID,
          client_secret: process.env.KAKAO_CLIENT_SECRET,
          code,
          redirect_uri: process.env.KAKAO_REDIRECT_URI,
        }
      });

      userRes = await axios.get("https://kapi.kakao.com/v2/user/me", {
        headers: { Authorization: `Bearer ${tokenRes.data.access_token}` }
      });
    }

    else if (provider === "facebook") {
      tokenRes = await axios.get("https://graph.facebook.com/v16.0/oauth/access_token", {
        params: {
          client_id: process.env.FACEBOOK_CLIENT_ID,
          client_secret: process.env.FACEBOOK_CLIENT_SECRET,
          redirect_uri: process.env.FACEBOOK_REDIRECT_URI,
          code,
        }
      });

      userRes = await axios.get("https://graph.facebook.com/me", {
        params: {
          access_token: tokenRes.data.access_token,
          fields: "id,name,email"
        }
      });
    }

    const profile = userRes.data;
    const email = profile.email;
    const socialId = profile.id || profile.sub;

    let user = await strapi.db.query("plugin::users-permissions.user").findOne({
      where: { email }
    });

    if (!user) {
      user = await strapi.db.query("plugin::users-permissions.user").create({
        data: {
          username: profile.name || email,
          email,
          provider,
          socialId,
        }
      });
    }

    const token = jwt.issue({ id: user.id });
    ctx.body = { jwt: token, user };
  }
};
```

---

### 4\. í™˜ê²½ë³€ìˆ˜ ì„¤ì • (.env)

```
GOOGLE_CLIENT_ID=xxxx
GOOGLE_CLIENT_SECRET=xxxx
GOOGLE_REDIRECT_URI=https://your-domain.com/auth/google/callback

NAVER_CLIENT_ID=xxxx
NAVER_CLIENT_SECRET=xxxx
NAVER_STATE=xxxx
NAVER_REDIRECT_URI=https://your-domain.com/auth/naver/callback

KAKAO_CLIENT_ID=xxxx
KAKAO_CLIENT_SECRET=xxxx
KAKAO_REDIRECT_URI=https://your-domain.com/auth/kakao/callback

FACEBOOK_CLIENT_ID=xxxx
FACEBOOK_CLIENT_SECRET=xxxx
FACEBOOK_REDIRECT_URI=https://your-domain.com/auth/facebook/callback
```

---

ì´ êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©´ Strapi Community Editionì—ì„œë„ **ë„¤ì´ë²„, ì¹´ì¹´ì˜¤, êµ¬ê¸€, í˜ì´ìŠ¤ë¶ 4ê°œ ì†Œì…œ ë¡œê·¸ì¸ì„ ë¬´ë£Œë¡œ** êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.