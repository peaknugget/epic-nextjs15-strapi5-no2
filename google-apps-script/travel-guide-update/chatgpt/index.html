<!-- index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ìŠ¤ë§ˆíŠ¸ ì—¬í–‰ ê°€ì´ë“œ</title>

  <style>
    /* =========== ê¸°ë³¸ ë ˆì´ì•„ì›ƒ =========== */
    :root{
      --bg: linear-gradient(180deg,#f8fdff 0%, #e8f7ff 100%);
      --card: rgba(255,255,255,0.9);
      --accent: #00bcd4;
      --accent-dark: #019fb0;
      --muted: #6b7280;
      --happy: #ffb86b;
      font-family: "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{
      height:100%;
      margin:0;
      background: var(--bg);
      color:#102a43;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .container{
      max-width:1100px;
      margin: 28px auto;
      padding: 20px;
    }

    /* Header */
    header{
      text-align:center;
      margin-bottom:18px;
    }
    .title{
      font-size: clamp(20px, 3.6vw, 32px);
      font-weight:800;
      letter-spacing:-0.02em;
      margin:0;
      color:#073642;
    }
    .subtitle{
      margin-top:6px;
      color:var(--muted);
    }

    /* Main grid */
    .grid{
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:20px;
    }

    /* Left panel (form) */
    .panel{
      background:var(--card);
      border-radius:16px;
      padding:18px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.06);
    }
    .label{ font-weight:700; margin-bottom:6px; color:#044e57; }
    .input-text{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(4,78,87,0.06);
      font-size:14px;
    }
    .row{ margin-bottom:12px; }

    .radio-row, .checkbox-row { display:flex; gap:8px; flex-wrap:wrap; }
    .radio-row label, .checkbox-row label{
      padding:8px 12px;
      background: rgba(1,159,176,0.06);
      border-radius:10px;
      cursor:pointer;
      font-size:13px;
    }

    select.input-select{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(4,78,87,0.06);
      font-size:14px;
    }

    /* slider */
    .slider-wrap{ display:flex; align-items:center; gap:12px; }
    input[type="range"]{ width:100%; }

    /* submit button */
    .btn{
      display:block;
      margin:18px auto 6px;
      padding:12px 18px;
      background: linear-gradient(90deg,var(--accent),var(--accent-dark));
      color:white;
      border:none;
      border-radius:12px;
      font-size:16px;
      cursor:pointer;
      box-shadow: 0 8px 20px rgba(1,159,176,0.16);
    }

    /* right panel (results) */
    .results{
      min-height:240px;
      background:transparent;
    }
    .spinner{
      display:none;
      margin:18px auto;
      text-align:center;
    }
    .cards{
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(260px,1fr));
      gap:12px;
    }
    .card{
      background: white;
      border-radius:12px;
      padding:12px;
      box-shadow: 0 6px 18px rgba(4,78,87,0.04);
      overflow:auto;
      max-height:420px;
    }
    .card h4{ margin:0 0 8px 0; font-size:16px; color:#032b2f; }
    .muted{ color:var(--muted); font-size:13px; }

    footer{
      margin-top:18px;
      text-align:center;
      font-size:13px;
      color:var(--muted);
    }

    /* responsive */
    @media (max-width:880px){
      .grid{ grid-template-columns: 1fr; }
      .panel{ order:2; }
      .results{ order:1; margin-bottom:10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1 class="title">ìŠ¤ë§ˆíŠ¸ ì—¬í–‰ ê°€ì´ë“œ</h1>
      <div class="subtitle">AIê°€ ì¶”ì²œí•˜ëŠ” ë§ì¶¤í˜• ì—¬í–‰ ê²½ë¡œ â€” ì„¤ë ˆëŠ” ì—¬í–‰ ê³„íšì„ ì§€ê¸ˆ ë°”ë¡œ ë°›ì•„ë³´ì„¸ìš” âœ¨</div>
    </header>

    <div class="grid">
      <!-- Form panel -->
      <div class="panel" aria-labelledby="form">
        <div class="row">
          <div class="label">ì—¬í–‰ì§€ ì…ë ¥</div>
          <input id="destination" class="input-text" type="text" placeholder="ì˜ˆ: ì¼ë³¸ ë„ì¿„, í”„ë‘ìŠ¤ íŒŒë¦¬">
        </div>

        <div class="row">
          <div class="label">ì¸ì›ìˆ˜</div>
          <div class="radio-row" id="peopleGroup">
            <label><input type="radio" name="people" value="1ëª…" checked> 1ëª…</label>
            <label><input type="radio" name="people" value="2ëª…"> 2ëª…</label>
            <label><input type="radio" name="people" value="3-4ëª…"> 3-4ëª…</label>
            <label><input type="radio" name="people" value="5ëª… ì´ìƒ"> 5ëª… ì´ìƒ</label>
          </div>
        </div>

        <div class="row">
          <div class="label">ì„±ë³„ êµ¬ì„±</div>
          <div class="radio-row">
            <label><input type="radio" name="gender" value="ë‚¨ì„±ë§Œ" checked> ë‚¨ì„±ë§Œ</label>
            <label><input type="radio" name="gender" value="ì—¬ì„±ë§Œ"> ì—¬ì„±ë§Œ</label>
            <label><input type="radio" name="gender" value="í˜¼ì„±"> í˜¼ì„±</label>
          </div>
        </div>

        <div class="row">
          <div class="label">ë‚˜ì´ëŒ€</div>
          <select id="ageRange" class="input-select">
            <option>20ëŒ€</option>
            <option>30ëŒ€</option>
            <option>40ëŒ€</option>
            <option>50ëŒ€ ì´ìƒ</option>
            <option>í˜¼í•©</option>
          </select>
        </div>

        <div class="row">
          <div class="label">ì—¬í–‰ ìŠ¤íƒ€ì¼ (ë³µìˆ˜ì„ íƒ)</div>
          <div class="checkbox-row">
            <label><input type="checkbox" value="ì†”ë¡œì—¬í–‰"> ì†”ë¡œì—¬í–‰</label>
            <label><input type="checkbox" value="íœ´ì–‘ì—¬í–‰"> íœ´ì–‘ì—¬í–‰</label>
            <label><input type="checkbox" value="ê°€ì¡±ì—¬í–‰"> ê°€ì¡±ì—¬í–‰</label>
            <label><input type="checkbox" value="ì»¤í”Œì—¬í–‰"> ì»¤í”Œì—¬í–‰</label>
            <label><input type="checkbox" value="ë¹„ì¦ˆë‹ˆìŠ¤"> ë¹„ì¦ˆë‹ˆìŠ¤</label>
          </div>
        </div>

        <div class="row">
          <div class="label">ì—¬í–‰ ì¼ìˆ˜: <span id="daysLabel">3ì¼</span></div>
          <div class="slider-wrap">
            <input id="days" type="range" min="1" max="7" value="3">
          </div>
        </div>

        <div class="row">
          <div class="label">ì˜ˆì‚° ê·œëª¨</div>
          <div class="radio-row">
            <label><input type="radio" name="budget" value="100ë§Œì› ì´í•˜" checked> 100ë§Œì› ì´í•˜</label>
            <label><input type="radio" name="budget" value="100-200ë§Œì›"> 100-200ë§Œì›</label>
            <label><input type="radio" name="budget" value="200ë§Œì› ì´ìƒ"> 200ë§Œì› ì´ìƒ</label>
          </div>
        </div>

        <div class="row">
          <div class="label">ì¶”ê°€ ìš”ì²­ / ì„ í˜¸ì‚¬í•­</div>
          <textarea id="requestText" class="input-text" rows="4" placeholder="íŠ¹ë³„íˆ ì›í•˜ëŠ” í™œë™ì´ë‚˜ ì œì™¸í•˜ê³  ì‹¶ì€ ê²ƒë“¤(ì˜ˆ: ì‡¼í•‘ ìœ„ì£¼, ë°•ë¬¼ê´€ ì¤‘ì‹¬ ë“±)"></textarea>
        </div>

        <button id="submitBtn" class="btn">ğŸ¯ ì—¬í–‰ ê²½ë¡œ ì¶”ì²œë°›ê¸°</button>
      </div>

      <!-- Results area -->
      <div class="results">
        <div class="panel">
          <div id="spinner" class="spinner">
            <div style="font-weight:700; color:var(--accent-dark)">AIê°€ ì—¬í–‰ì„ ì •ë¦¬ì¤‘ì…ë‹ˆë‹¤... ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” âœ¨</div>
            <div style="margin-top:8px">
              <svg width="60" height="60" viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" stroke="rgba(1,159,176,0.18)" stroke-width="6" fill="none"></circle><path d="M45 25a20 20 0 0 1-20 20" stroke="var(--accent-dark)" stroke-width="6" stroke-linecap="round"></path></svg>
            </div>
          </div>

          <div id="cards" class="cards" aria-live="polite"></div>

          <div id="recentHeading" style="margin-top:12px; font-weight:700; color:#044e57">ìµœê·¼ ìš”ì²­ ê²°ê³¼</div>
          <div id="recentCards" class="cards" style="margin-top:8px"></div>
        </div>
      </div>
    </div>

    <footer>
      <div>ì•± ì‚¬ìš© ë°©ë²•: ì—¬í–‰ì§€ì™€ ì¡°ê±´ì„ ì…ë ¥í•œ ë’¤ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”. ìƒì„±ëœ ì¼ì •ì€ êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥ë©ë‹ˆë‹¤.</div>
      <div style="margin-top:6px; font-weight:700">Powered by Macaronics.net</div>
    </footer>
  </div>

  <script>
    // UI ì´ˆê¸°í™”
    const daysInput = document.getElementById('days');
    const daysLabel = document.getElementById('daysLabel');
    daysLabel.textContent = daysInput.value + 'ì¼';
    daysInput.addEventListener('input', ()=> daysLabel.textContent = daysInput.value + 'ì¼');

    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');
    const cards = document.getElementById('cards');
    const recentCards = document.getElementById('recentCards');

    function getFormData() {
      const destination = document.getElementById('destination').value.trim();
      const people = document.querySelector('input[name="people"]:checked').value;
      const gender = document.querySelector('input[name="gender"]:checked').value;
      const ageRange = document.getElementById('ageRange').value;
      const styles = Array.from(document.querySelectorAll('.checkbox-row input:checked')).map(i=>i.value);
      const days = document.getElementById('days').value;
      const budget = document.querySelector('input[name="budget"]:checked').value;
      const requestText = document.getElementById('requestText').value.trim();

      return { destination, people, gender, ageRange, styles, days, budget, requestText };
    }

    function showSpinner(show){
      spinner.style.display = show ? 'block' : 'none';
    }

    function renderResultCard(title, htmlContent) {
      const card = document.createElement('div');
      card.className = 'card';
      const h = document.createElement('h4');
      h.textContent = title;
      card.appendChild(h);

      const pre = document.createElement('div');
      pre.className = 'muted';
      pre.style.whiteSpace = 'pre-wrap';
      pre.style.fontSize = '14px';
      pre.textContent = htmlContent;
      card.appendChild(pre);

      return card;
    }

    // ì œì¶œ ì²˜ë¦¬
    submitBtn.addEventListener('click', function(){
      const data = getFormData();
      if (!data.destination) {
        alert('ì—¬í–‰ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      // UI
      cards.innerHTML = '';
      showSpinner(true);

      // google.script.run í˜¸ì¶œ
      google.script.run.withSuccessHandler(function(res){
        showSpinner(false);
        if (!res) {
          alert('ì„œë²„ì—ì„œ ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
          return;
        }
        if (res.success) {
          // ê²°ê³¼ í‘œì‹œ
          const text = res.result || '(AIê°€ ë‚´ìš©ì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤)';
          const title = data.destination + ' â€¢ ' + data.days + 'ì¼';
          cards.appendChild(renderResultCard(title, text));

          // ìµœì‹  ëª©ë¡ ê°±ì‹ 
          loadRecent();
        } else {
          alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + (res.error || 'Unknown error'));
        }
      }).withFailureHandler(function(err){
        showSpinner(false);
        alert('ì„œë²„ í˜¸ì¶œ ì‹¤íŒ¨: ' + JSON.stringify(err));
      }).generateItinerary(data);
    });

    // ìµœê·¼ ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸° (í˜ì´ì§€ ë¡œë“œ ì‹œ í‘œì‹œ)
    function loadRecent(){
      google.script.run.withSuccessHandler(function(rows){
        recentCards.innerHTML = '';
        if (!rows || !rows.length) {
          recentCards.innerHTML = '<div class="muted" style="padding:6px">ìµœê·¼ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        rows.forEach(r=>{
          const title = `${r.destination || '(ë¬´ì œ)'} â€¢ ${r.timestamp}`;
          const card = renderResultCard(title, r.aiResponse || '(ì‘ë‹µ ì—†ìŒ)');
          recentCards.appendChild(card);
        });
      }).getRecentResults(6);
    }

    // ì´ˆê¸° ë¡œë“œ
    loadRecent();
  </script>

  <!-- google script service (Apps Scriptì—ì„œ ìë™ ì²˜ë¦¬) -->
</body>
</html>
